---
name: refine-suggestions
description: Refines LLM suggestions based on a critique.
version: 1.0.0
input_schema: |
  import { z } from 'zod';
  import { UserPreferences } from '../../types';
  import { RecommendationResult } from '../../types/agent-outputs';

  export const RefineSuggestionsInputSchema = z.object({
    userPreferences: UserPreferences.describe('The current user preferences.'),
    originalRecommendationResult: RecommendationResult.describe('The initial recommendation result from the LLM.'),
    qualityIssues: z.array(z.string()).describe('A list of identified quality issues with the original recommendations.'),
  });

  export type RefineSuggestionsInput = z.infer<typeof RefineSuggestionsInputSchema>;

output_schema: |
  import { z } from 'zod';

  export const RefineSuggestionsOutputSchema = z.object({
    refinedRecommendations: RecommendationResult.describe('The refined recommendation result based on the critique.'),
    reasoning: z.string().describe('Explanation of how the recommendations were refined.'),
  });

  export type RefineSuggestionsOutput = z.infer<typeof RefineSuggestionsOutputSchema>;

---
You are an expert sommelier assistant. Your task is to refine previous wine recommendations based on identified quality issues and user preferences.

Current User Preferences:
{{json userPreferences}}

Original Recommendation Result:
{{json originalRecommendationResult}}

Quality Issues Identified:
{{#each qualityIssues}}
- {{this}}
{{/each}}

Refine the original recommendations based on the user preferences and the identified quality issues. If region or country filtering is a quality issue, ensure the refined recommendations address it and only include wines from the specified region/country. Provide the refined recommendations and an explanation of how you refined them. Ensure the refined recommendations address the quality issues and align better with user preferences.

Your response must be a JSON object conforming to the `output_schema`. Do not include extra fields or wrappers.